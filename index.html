<!doctype html>
  <link rel="stylesheet" href="style.css" />

  <body>
    <div id="root"></div>
    <canvas id="export" width=100 height=100></img>
    <script src="elm.js"></script>
    <script>
      var app = Elm.Main.embed(document.getElementById("root"));
      app.ports.exportToImage.subscribe(function(id) {
        var canvas = document.getElementById('export')
        var ctx = canvas.getContext("2d")

        img = new Image()
        img.onload = function() {
          var oc = document.createElement('canvas')
          var octx = oc.getContext('2d')
          oc.width = img.width * 0.5;
          oc.height = img.height * 0.5;

          octx.drawImage(img, 0, 0, oc.width, oc.height)
          octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);

          canvas.width = 300
          canvas.height = 200
          ctx.drawImage(oc,0,0, oc.width * 0.5, oc.height * 0.5,
                             0,0, canvas.width,canvas.height);
          var drawing = document.querySelector('#annotation-app canvas')
          ctx.drawImage(drawing,0,0, 300, 200)
          // var exportUrl = exportCanvas.toDataURL('image/jpeg', 1.0)
          // var exportImg = document.getElementById('export');
          // exportImg.src = exportUrl
        }
        // img.src = 'https://upload.wikimedia.org/wikipedia/commons/f/ff/Domestic_goat_kid_in_capeweed.jpg'
        img.src = 'photo.jpg'
      });
    </script>
  </body>

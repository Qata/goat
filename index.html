<!doctype html>
  <link rel="stylesheet" href="style.css" />

  <body>
    <div id="root"></div>
    <canvas id="export" width=100 height=100 style="display:none;"></canvas>
    <div id="export-image"></div>
    <script src="elm.js"></script>
    <script>
      var app = Elm.Main.embed(document.getElementById("root"));
      app.ports.exportToImage.subscribe(function(id) {
        var canvas = document.getElementById('export')
        var ctx = canvas.getContext("2d")

        var img = new Image()
        img.onload = function() {
          var oc = document.createElement('canvas')
          var octx = oc.getContext('2d')
          oc.width = img.width * 0.5;
          oc.height = img.height * 0.5;

          octx.drawImage(img, 0, 0, oc.width, oc.height)
          octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);

          canvas.width = 300
          canvas.height = 200
          ctx.drawImage(oc,0,0, oc.width * 0.5, oc.height * 0.5,
                             0,0, canvas.width,canvas.height);
          var drawing = document.querySelector('#annotation-app canvas')
          ctx.drawImage(drawing,0,0, 300, 200)
          canvas.toBlob(blob => {
            var exportImage = new Image()
            exportImage.id = 'export-image'
            exportImage.src = URL.createObjectURL(blob)
            document.body.replaceChild(exportImage, document.getElementById('export-image'))
          })
        }
        img.src = 'photo.jpg'
      });
    </script>
  </body>
